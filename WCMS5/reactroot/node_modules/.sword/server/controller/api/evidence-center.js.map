{
  "version": 3,
  "sources": [
    "../../../../../src/controller/api/evidence-center.js"
  ],
  "names": [
    "get",
    "post",
    "controller",
    "sword",
    "Decorator",
    "commonFun",
    "require",
    "evidenceCenter",
    "Controller",
    "getSubserverInfo",
    "data",
    "service",
    "query",
    "errorcode",
    "success",
    "Error",
    "e",
    "logger",
    "error",
    "json",
    "code",
    "fail",
    "detail",
    "result",
    "sendEmail",
    "reqData",
    "request",
    "body",
    "content",
    "decodeURI",
    "saveEvidence",
    "mapDetail",
    "alarmStatus",
    "downloadUrl",
    "token",
    "cookieName",
    "getUserCookierName",
    "cookier",
    "ctx",
    "cookies",
    "cookieObj",
    "base642object",
    "getWcms4Token",
    "uid",
    "rid",
    "reqBody",
    "type",
    "msg",
    "source",
    "time",
    "getNowDateTime",
    "terid",
    "key",
    "rs",
    "filePath",
    "path",
    "driverList",
    "driver",
    "deletePack"
  ],
  "mappings": "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",
  "sourcesContent": [
    "const { get, post, controller } = sword.Decorator;\r\nconst commonFun = require('../../utils/commonFun.js');\r\n\r\n@controller('/api/evidence-center')\r\nclass evidenceCenter extends sword.Controller {\r\n    @get('/subserverinfo')\r\n    async getSubserverInfo() {\r\n        try {\r\n            const data = await sword.service('evidence-center.evidenceSubServerInfo')(this.query);\r\n            if (data.errorcode === 200) {\r\n                this.success(data.data);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${data.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            const json = {\r\n                code: 202,\r\n                data: []\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n\r\n    @get('/detail')\r\n    async detail() {\r\n        try {\r\n            const data = await sword.service('evidence-center.evidenceCenterDetail')(this.query);\r\n            if (data.errorcode === 200) {\r\n                this.success(data.result);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${data.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            const json = {\r\n                code: 202,\r\n                data: []\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n\r\n    @post('/send-email')\r\n    async sendEmail() {\r\n        try {\r\n            const reqData = this.request.body;\r\n            reqData.content = decodeURI(reqData.content);\r\n            const data = await sword.service('evidence-center.evidenceCenterSendEmail')(reqData);\r\n            if (data.errorcode === 200) {\r\n                this.success(data.result);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${data.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            const json = {\r\n                code: 202,\r\n                data: false\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n\r\n    @post('/save-evidence')\r\n    async saveEvidence() {\r\n        try {\r\n            const data = await sword.service('evidence-center.saveEvidence')(this.request.body);\r\n            if (data.errorcode === 200 && data.data.result) {\r\n                this.success(true);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${data.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            const json = {\r\n                code: 202,\r\n                data: []\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n\r\n    @get('/map-detail')\r\n    async mapDetail() {\r\n        try {\r\n            const data = await sword.service('evidence-center.evidenceCenterRelatedgpsalarm')(this.query);\r\n            if (data.errorcode === 200) {\r\n                this.success(data.result);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${data.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            const json = {\r\n                code: 202,\r\n                data: []\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n\r\n    @get('/alarm-status')\r\n    async alarmStatus() {\r\n        try {\r\n            const data = await sword.service('evidence-center.evidenceCenterAlarmStatus')(this.query);\r\n            if (data.errorcode === 200) {\r\n                this.success(data.result);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${data.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            const json = {\r\n                code: 202,\r\n                data: []\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n\r\n    @post('/downloadUrl')\r\n    async downloadUrl() {\r\n        try {\r\n            const { body } = this.request;\r\n            let token = '';\r\n            // 处理token\r\n            const cookieName = commonFun.getUserCookierName();\r\n            const cookier = this.ctx.cookies.get(cookieName);\r\n            if (cookier) {\r\n                const cookieObj = commonFun.base642object(cookier);\r\n                token = commonFun.getWcms4Token(cookieObj.uid, cookieObj.rid);\r\n            } else if (body.rid && body.uid) {\r\n                token = commonFun.getWcms4Token(body.uid, body.rid);\r\n            } else if (body.token) {\r\n                token = body.token;\r\n            }\r\n            // 写下载日志\r\n            const reqBody = {\r\n                data: [\r\n                    {\r\n                        type: 'd-e-f',\r\n                        msg: '',\r\n                        source: 1, // web\r\n                        time: commonFun.getNowDateTime(),\r\n                        terid: ''\r\n                    }\r\n                ],\r\n                key: token\r\n            };\r\n            await sword.service('evidence-center.evidenceCenterLogDownload')(reqBody);\r\n            // 获取下载路径\r\n            const rs = await sword.service('evidence-center.evidenceCenterGetDownloadUrl')(body);\r\n            // 拼装文件路径\r\n            const filePath = rs.data.path;\r\n            if (rs.errorcode === 200) {\r\n                this.success(filePath);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${rs.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            const json = {\r\n                code: 202,\r\n                data: false,\r\n                errorcode: e\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n\r\n    @get('/driver-list')\r\n    async driverList() {\r\n        try {\r\n            const data = await sword.service('evidence-center.getDriverNameList')(this.query);\r\n            if (data.errorcode === 200) {\r\n                this.success(data.data.driver);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${data.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            const json = {\r\n                code: 202,\r\n                data: [],\r\n                errorcode: e\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n\r\n    @get('/delete-pack')\r\n    async deletePack() {\r\n        try {\r\n            const data = await sword.service('evidence-center.deletePack')(this.query);\r\n            if (data.errorcode === 200) {\r\n                this.success(data.result);\r\n            } else {\r\n                throw new Error(`errorcode != 200, errorcode=${data.errorcode}`);\r\n            }\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            const json = {\r\n                code: 202,\r\n                data: [],\r\n                errorcode: e\r\n            };\r\n            this.fail(json);\r\n        }\r\n    }\r\n}\r\nexport default evidenceCenter;\r\n"
  ],
  "file": "evidence-center.js"
}