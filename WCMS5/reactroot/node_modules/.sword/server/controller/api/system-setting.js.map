{
  "version": 3,
  "sources": [
    "../../../../../src/controller/api/system-setting.js"
  ],
  "names": [
    "get",
    "put",
    "controller",
    "sword",
    "Decorator",
    "SYSTEM_DATA_DIR",
    "path",
    "join",
    "ROOT_PATH",
    "getLanguageTypes",
    "typeDir",
    "files",
    "fs",
    "readdirSync",
    "sort",
    "a",
    "b",
    "localeCompare",
    "types",
    "forEach",
    "fileName",
    "extname",
    "push",
    "basename",
    "getLanguageData",
    "lang",
    "localeDir",
    "alarmtypeDir",
    "handleDir",
    "titleDir",
    "langeageData",
    "langList",
    "includes",
    "config",
    "filePathLocale",
    "filePathAlarmtype",
    "filePathHandleMethod",
    "filePathTitle",
    "jsonStrLocale",
    "readFileSync",
    "toString",
    "jsonStrAlarmtype",
    "jsonStrHandleMethod",
    "jsonStrTitle",
    "type",
    "langData",
    "JSON",
    "parse",
    "alarmtypeData",
    "handleMethodData",
    "titleData",
    "saveLocales",
    "locales",
    "item",
    "filePath",
    "jsonStr",
    "stringify",
    "data",
    "writeFileSync",
    "Test",
    "Controller",
    "codeFilePath",
    "listJsonStr",
    "listJson",
    "result",
    "map",
    "key",
    "code",
    "name",
    "success",
    "getLanguageResources",
    "json",
    "i18nextData",
    "query",
    "translation",
    "e",
    "logger",
    "error",
    "getSystemConfig",
    "service",
    "editSystemConfig",
    "request",
    "body",
    "editWcms5SystemConfig",
    "dirArr",
    "split",
    "sep",
    "splice",
    "length",
    "wcms5Root",
    "appPath",
    "appJson",
    "existsSync",
    "port"
  ],
  "mappings": "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",
  "sourcesContent": [
    "import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst { get, put, controller } = sword.Decorator;\r\n\r\nconst SYSTEM_DATA_DIR = path.join(sword.ROOT_PATH, 'system-data');\r\n\r\n/**\r\n * 获取语言包类型列表\r\n * @return ['zh-CN', 'en-US']\r\n */\r\nfunction getLanguageTypes() {\r\n    const typeDir = path.join(SYSTEM_DATA_DIR, 'locales', 'types');\r\n    const files = fs.readdirSync(typeDir);\r\n    // 按照语言包名称排序\r\n    files.sort((a, b) => a.localeCompare(b));\r\n    const types = [];\r\n    files.forEach(fileName => {\r\n        if (path.extname(fileName) === '.json') {\r\n            types.push(path.basename(fileName, '.json'));\r\n        }\r\n    });\r\n    return types;\r\n}\r\n\r\n/**\r\n * 读取语言包数据\r\n * @return [{type:'en-US', langData:{key: value}, alarmtypeData:{key: value}}]\r\n */\r\nfunction getLanguageData(lang) {\r\n    const localeDir = path.join(SYSTEM_DATA_DIR, 'locales', 'types');\r\n    const alarmtypeDir = path.join(SYSTEM_DATA_DIR, 'alarmtype', 'types');\r\n    const handleDir = path.join(SYSTEM_DATA_DIR, 'handlemethod', 'types');\r\n    const titleDir = path.join(SYSTEM_DATA_DIR, 'title', 'types');\r\n    const langeageData = [];\r\n    const langList = getLanguageTypes();\r\n    lang = langList.includes(lang) ? lang : sword.config('lang');\r\n    const filePathLocale = path.join(localeDir, `${lang}.json`);\r\n    const filePathAlarmtype = path.join(alarmtypeDir, `${lang}.json`);\r\n    const filePathHandleMethod = path.join(handleDir, `${lang}.json`);\r\n    const filePathTitle = path.join(titleDir, `${lang}.json`);\r\n    const jsonStrLocale = fs.readFileSync(filePathLocale).toString();\r\n    const jsonStrAlarmtype = fs.readFileSync(filePathAlarmtype).toString();\r\n    const jsonStrHandleMethod = fs.readFileSync(filePathHandleMethod).toString();\r\n    const jsonStrTitle = fs.readFileSync(filePathTitle).toString();\r\n    langeageData.push({\r\n        type: lang,\r\n        langData: JSON.parse(jsonStrLocale),\r\n        alarmtypeData: JSON.parse(jsonStrAlarmtype),\r\n        handleMethodData: JSON.parse(jsonStrHandleMethod),\r\n        titleData: JSON.parse(jsonStrTitle)\r\n    });\r\n    return langeageData;\r\n}\r\n\r\n/**\r\n * 持久化保存语言包\r\n */\r\n// eslint-disable-next-line no-unused-vars\r\nfunction saveLocales(locales) {\r\n    locales.forEach(item => {\r\n        const filePath = path.join(SYSTEM_DATA_DIR, 'locales', 'types', `${item.type}.json`);\r\n        const jsonStr = JSON.stringify(item.data, null, 4);\r\n        fs.writeFileSync(filePath, jsonStr);\r\n    });\r\n}\r\n\r\n@controller('/api/system-setting')\r\nclass Test extends sword.Controller {\r\n    @get('/language/type')\r\n    getLanguageTypes() {\r\n        const types = getLanguageTypes();\r\n        const codeFilePath = path.join(SYSTEM_DATA_DIR, 'locales', 'list.json');\r\n        const listJsonStr = fs.readFileSync(codeFilePath);\r\n        const listJson = JSON.parse(listJsonStr);\r\n        const result = types.map(key => ({\r\n            code: key,\r\n            name: listJson[key]\r\n        }));\r\n        this.success(result);\r\n    }\r\n\r\n    @get('/language/resources')\r\n    getLanguageResources() {\r\n        // 当语言类型不存在时,返回英语\r\n        const json = {\r\n            type: '',\r\n            i18nextData: {},\r\n            alarmtypeData: {},\r\n            handleMethodData: {},\r\n            titleData: {}\r\n        };\r\n        try {\r\n            const { lang } = this.query;\r\n            const langeageData = getLanguageData(lang);\r\n            langeageData.forEach(item => {\r\n                json.type = item.type;\r\n                json.i18nextData[item.type] = {\r\n                    translation: item.langData\r\n                };\r\n                json.alarmtypeData[item.type] = item.alarmtypeData;\r\n                json.handleMethodData[item.type] = item.handleMethodData;\r\n                json.titleData[item.type] = item.titleData;\r\n            });\r\n            this.success(json);\r\n        } catch (e) {\r\n            sword.logger.error(e);\r\n            this.success(json);\r\n        }\r\n    }\r\n\r\n    @get('/config')\r\n    async getSystemConfig() {\r\n        const data = await sword.service('system-setting.getSystemConfig')();\r\n        this.success(data);\r\n    }\r\n\r\n    @put('/config')\r\n    async editSystemConfig() {\r\n        const data = await sword.service('system-setting.editSystemConfig')(this.request.body);\r\n        this.success(data);\r\n    }\r\n\r\n    /**\r\n     * 获取wcms5系统配置\r\n     */\r\n    @get('/wcms5Config')\r\n    async editWcms5SystemConfig() {\r\n        const dirArr = SYSTEM_DATA_DIR.split(path.sep);\r\n        dirArr.splice(dirArr.length - 2, dirArr.length - 1);\r\n        const wcms5Root = dirArr.join(path.sep);\r\n        const appPath = path.join(wcms5Root, 'root', 'config', 'app.json');\r\n        let appJson = '{\"port\":\"12056\"}';\r\n        if (fs.existsSync(appPath)) {\r\n            appJson = fs.readFileSync(appPath);\r\n        }\r\n        const data = JSON.parse(appJson);\r\n        this.success(data.port);\r\n    }\r\n}\r\nexport default Test;\r\n"
  ],
  "file": "system-setting.js"
}