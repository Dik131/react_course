"use strict";

exports.__esModule = true;
exports.default = void 0;

const path = require('path');

const fs = require('fs');

const server = sword.config('server');
const serverWeb = sword.config('serverWeb');
const ROOT_PATH = sword.ROOT_PATH;

function getDistributedConfigPath() {
  const dirArr = ROOT_PATH.split(path.sep);
  dirArr.splice(dirArr.length - 2, dirArr.length - 1);
  const projectPath = dirArr.join(path.sep);
  const distributedConfigPath = path.join(projectPath, 'TransmitServer', 'config', 'evidencedistributedconfig.json');
  let serverConfig = null;

  if (fs.existsSync(distributedConfigPath)) {
    serverConfig = fs.readFileSync(distributedConfigPath);
  }

  return serverConfig;
}

function configServer() {
  let flag = 0;
  let serverConfig = getDistributedConfigPath();

  if (serverConfig) {
    serverConfig = JSON.parse(serverConfig);
    serverConfig.subserver.forEach(item => {
      if (item.enable != 0) {
        flag = 1;
      }
    });

    if (serverConfig.mainserver.enable != 0 || flag === 1) {
      serverWeb[0].host = serverConfig.mainserver.ip;
      serverWeb[0].port = serverConfig.mainserver.serverwebport;
    }
  }
}

configServer();
var _default = [{
  name: 'evidenceCenterDetail',
  server,
  path: '/alarm/detailandhandle',
  method: 'post',
  pack: 'json'
}, {
  name: 'evidenceCenterSendEmail',
  server,
  path: '/api/v1/evidence/sendmail',
  method: 'post',
  pack: 'json'
}, {
  name: 'evidenceCenterRelatedgpsalarm',
  server,
  path: '/alarm/relatedgpsalarm',
  method: 'post',
  pack: 'json'
}, {
  name: 'evidenceCenterAlarmStatus',
  server,
  path: '/alarm/status',
  method: 'post',
  pack: 'json'
}, {
  name: 'evidenceCenterGetDownloadUrl',
  server,
  path: '/api/v1/evidence/download/pack?key=123',
  method: 'post',
  pack: 'json'
}, {
  name: 'evidenceCenterLogDownload',
  server: serverWeb,
  path: '/opt/add',
  method: 'post',
  pack: 'json'
}, {
  name: 'getDriverNameList',
  server,
  path: '/api/v1/base/drivers',
  method: 'post',
  pack: 'json'
}, {
  name: 'saveEvidence',
  server,
  path: '/api/v1/evidence/save',
  method: 'post',
  pack: 'json'
}, {
  name: 'evidenceSubServerInfo',
  server,
  path: '/api/v1/evidence/evidenceserverinfo',
  method: 'post',
  pack: 'json'
}, {
  name: 'deletePack',
  server,
  path: '/api/v1/evidence/download/delpack',
  method: 'post',
  pack: 'json'
}];
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=evidence-center.js.map